---
import BlogPostCard from "../blog/BlogPostCard.astro";
import { getSortedPosts } from "../../data/blog";

interface Props {
    showAll?: boolean;
    limit?: number;
    hideHeader?: boolean;
}

const { showAll = false, limit = 3, hideHeader = false } = Astro.props;
const posts = getSortedPosts(showAll ? undefined : limit);
const hasMorePosts = !showAll && posts.length >= limit;
---

<section class="blog-section" id="blog">
    <div class="blog-container">
        {!hideHeader && (
            <>
                <h2 class="blog-title">
                    <span class="animated-icon">
                        <span class="base-icon">üìÑ</span>
                        <span class="pen-icon">‚úçÔ∏è</span>
                    </span>
                    Buƒçkov blog
                </h2>
                <p class="blog-description">
                    Zgodbe, dogodiv≈°ƒçine in nepozabni trenutki z na≈°im ljubljenim Buƒçkom
                </p>
            </>
        )}

        {
            posts.length > 0 ? (
                <div class="blog-grid" role="list">
                    {posts.map((post) => (
                        <BlogPostCard post={post} />
                    ))}
                </div>
            ) : (
                <div class="no-posts">
                    <div class="placeholder">
                        <div class="placeholder-icon">‚úçÔ∏è</div>
                        <h3>Kmalu na voljo!</h3>
                        <p>Nove objave na blogu bodo kmalu vidne tukaj!</p>
                    </div>
                </div>
            )
        }

        {
            hasMorePosts && (
                <div class="blog-footer">
                    <a href="/blog" class="btn-primary">
                        Preberi vse objave
                        <svg
                            width="20"
                            height="20"
                            viewBox="0 0 20 20"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path d="M9 5l5 5-5 5" />
                        </svg>
                    </a>
                </div>
            )
        }
    </div>
</section>

<style>
    .blog-section {
        margin-bottom: var(--spacing-4xl);
    }

    .blog-container {
        max-width: var(--container-xl);
        margin: 0 auto;
        padding: 0 var(--spacing-lg);
    }

    .blog-title {
        text-align: center;
        font-size: var(--font-size-4xl);
        color: var(--color-primary);
        margin-bottom: var(--spacing-md);
        font-weight: var(--font-weight-bold);
        line-height: var(--line-height-tight);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-md);
    }

    .animated-icon {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 1.5em;
        height: 1.5em;
        flex-shrink: 0;
    }

    .base-icon {
        font-size: 1.2em;
        line-height: 1;
    }

    .pen-icon {
        position: absolute;
        top: -0.2em;
        right: -0.2em;
        font-size: 0.8em;
        animation: writing 2s ease-in-out infinite;
        transform-origin: bottom left;
        pointer-events: none;
        z-index: 2;
    }

    @keyframes writing {
        0%, 100% { transform: translate(0, 0) rotate(0); }
        20% { transform: translate(-4px, 4px) rotate(-15deg); }
        40% { transform: translate(4px, -2px) rotate(10deg); }
        60% { transform: translate(-2px, 4px) rotate(-10deg); }
        80% { transform: translate(2px, -4px) rotate(15deg); }
    }

    .blog-description {
        text-align: center;
        font-size: var(--font-size-lg);
        color: var(--color-text-light);
        max-width: 600px;
        margin: 0 auto var(--spacing-xl);
        line-height: var(--line-height-relaxed);
    }

    .blog-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: var(--spacing-xl);
        margin-bottom: var(--spacing-2xl);
    }

    .no-posts {
        text-align: center;
        padding: var(--spacing-4xl) var(--spacing-xl);
        background: var(--color-bg-alt);
        border-radius: var(--radius-2xl);
        border: 2px dashed var(--color-border);
        margin-top: var(--spacing-xl);
    }

    .placeholder-icon {
        font-size: 4rem;
        margin-bottom: var(--spacing-md);
        animation: bounce 2s ease-in-out infinite;
    }

    @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
            transform: translateY(0);
        }
        40% {
            transform: translateY(-10px);
        }
        60% {
            transform: translateY(-5px);
        }
    }

    .placeholder h3 {
        color: var(--color-text);
        margin-bottom: var(--spacing-sm);
        font-size: var(--font-size-2xl);
        font-weight: var(--font-weight-bold);
    }

    .placeholder p {
        color: var(--color-text-light);
        font-size: var(--font-size-base);
        margin: 0;
    }

    .blog-footer {
        text-align: center;
        margin-top: var(--spacing-2xl);
    }

    .btn-primary {
        display: inline-flex;
        align-items: center;
        gap: var(--spacing-sm);
        background: var(--gradient-warm);
        color: white;
        padding: var(--spacing-md) var(--spacing-xl);
        border-radius: var(--radius-full);
        text-decoration: none;
        font-weight: var(--font-weight-semibold);
        font-size: var(--font-size-base);
        transition: all var(--transition-base);
        box-shadow: var(--shadow-sm);
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
        filter: brightness(1.1);
    }

    .btn-primary:focus-visible {
        outline: 2px solid var(--color-accent);
        outline-offset: 2px;
    }

    @media (max-width: 768px) {
        .blog-grid {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--spacing-lg);
        }

        .blog-title {
            font-size: var(--font-size-3xl);
        }

        .blog-description {
            font-size: var(--font-size-base);
        }

        .btn-primary {
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: var(--font-size-sm);
        }
    }

    @media (max-width: 640px) {
        .blog-grid {
            grid-template-columns: 1fr;
            gap: var(--spacing-md);
        }

        .blog-container {
            padding: 0 var(--spacing-md);
        }

        .blog-title {
            font-size: var(--font-size-2xl);
        }

        .no-posts {
            padding: var(--spacing-3xl) var(--spacing-md);
        }
    }
</style>
